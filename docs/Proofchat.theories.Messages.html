<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Proofchat.theories.Messages</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Proofchat.theories.Messages</h1>

<div class="code">
</div>

<div class="doc">
<a id="lab3"></a><h1 class="section">Messages</h1>


<div class="paragraph"> </div>

    In this section, we introduce well-formed usernames and messages, along
    with proof-carrying operations over them

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Proofchat.theories.OCamlTypes.html#"><span class="id" title="library">OCamlTypes</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Proofchat.theories.StringTheory.html#"><span class="id" title="library">StringTheory</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Proofchat.theories.Monads.html#"><span class="id" title="library">Monads</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.funind.Recdef.html#"><span class="id" title="library">Recdef</span></a>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">nat_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">sint63_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">monad_scope</span>.<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

    A proof-carrying username type

</div>
<div class="code">
<span class="id" title="keyword">Record</span> <a id="username" class="idref" href="#username"><span class="id" title="record">username</span></a> : <span class="id" title="keyword">Type</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="Uname" class="idref" href="#Uname"><span class="id" title="projection">Uname</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <a id="ValidLength" class="idref" href="#ValidLength"><span class="id" title="projection">ValidLength</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.ZArith.BinInt.html#6f909ea2391c6073ff1047e870dd64e2"><span class="id" title="notation">≤</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#to_Z"><span class="id" title="definition">to_Z</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#int_len_string"><span class="id" title="definition">int_len_string</span></a> <a class="idref" href="Proofchat.theories.Messages.html#Uname:2"><span class="id" title="method">Uname</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.ZArith.BinInt.html#6f909ea2391c6073ff1047e870dd64e2"><span class="id" title="notation">≤</span></a> 32)%<span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <a id="NoSpaces" class="idref" href="#NoSpaces"><span class="id" title="projection">NoSpaces</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#InString"><span class="id" title="definition">InString</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#space"><span class="id" title="definition">space</span></a> <a class="idref" href="Proofchat.theories.Messages.html#Uname:2"><span class="id" title="method">Uname</span></a><br/>
}.<br/>

<br/>
</div>

<div class="doc">
    Returns <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a></span> if
<ul class="doclist">
<li> The length of <span class="inlinecode"><span class="id" title="var">name</span></span> is in 
        <math>
            <mo>
                [</mo><mn>1</mn><mo>&#x22ef;</mo><mn>32</mn><mo>]
            </mo>
        </math>

</li>
<li> <span class="inlinecode"><span class="id" title="var">name</span></span> contains no spaces

</li>
</ul>
    and <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a></span> otherwise

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="validate_username" class="idref" href="#validate_username"><span class="id" title="definition">validate_username</span></a> (<a id="name:5" class="idref" href="#name:5"><span class="id" title="binder">name</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">((</span></a>1 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#a5702614ed847ad2954e9299f1612b24"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#int_len_string"><span class="id" title="definition">int_len_string</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name:5"><span class="id" title="variable">name</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.StringTheory.html#int_len_string"><span class="id" title="definition">int_len_string</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name:5"><span class="id" title="variable">name</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#a5702614ed847ad2954e9299f1612b24"><span class="id" title="notation">&lt;=?</span></a> 32<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.StringTheory.html#no_spaces"><span class="id" title="definition">no_spaces</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name:5"><span class="id" title="variable">name</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
    Ensure that <span class="inlinecode"><a class="idref" href="Proofchat.theories.Messages.html#validate_username"><span class="id" title="definition">validate_username</span></a></span> provides
    assurances for the properties we're
    interested in

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a id="validate_username_correct" class="idref" href="#validate_username_correct"><span class="id" title="lemma">validate_username_correct</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="name:6" class="idref" href="#name:6"><span class="id" title="binder">name</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="VALID:7" class="idref" href="#VALID:7"><span class="id" title="binder">VALID</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#validate_username"><span class="id" title="definition">validate_username</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name:6"><span class="id" title="variable">name</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.ZArith.BinInt.html#6f909ea2391c6073ff1047e870dd64e2"><span class="id" title="notation">≤</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#to_Z"><span class="id" title="definition">to_Z</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#int_len_string"><span class="id" title="definition">int_len_string</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name:6"><span class="id" title="variable">name</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.ZArith.BinInt.html#6f909ea2391c6073ff1047e870dd64e2"><span class="id" title="notation">≤</span></a> 32)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#InString"><span class="id" title="definition">InString</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#space"><span class="id" title="definition">space</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name:6"><span class="id" title="variable">name</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Proofchat.theories.Messages.html#validate_username"><span class="id" title="definition">validate_username</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">VALID</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Bool.Bool.html#andb_true_iff"><span class="id" title="lemma">andb_true_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">VALID</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">VALID</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Length</span> <span class="id" title="var">NoSpaces</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Bool.Bool.html#andb_true_iff"><span class="id" title="lemma">andb_true_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Length</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">NonEmpty</span> <span class="id" title="var">Le32</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#leb_spec"><span class="id" title="axiom">leb_spec</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">NonEmpty</span>, <span class="id" title="var">Le32</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">change</span> 1%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#to_Z"><span class="id" title="definition">to_Z</span></a> 1). <span class="id" title="var">now</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">clear</span> - <span class="id" title="var">NoSpaces</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">name</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">a</span> <span class="id" title="var">name'</span>]. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">NoSpaces</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.Ascii.html#ascii_dec"><span class="id" title="definition">ascii_dec</span></a> <span class="id" title="var">a</span> <a class="idref" href="Proofchat.theories.StringTheory.html#space"><span class="id" title="definition">space</span></a>) <span class="id" title="keyword">as</span> [<span class="id" title="var">a_space</span>|<span class="id" title="var">a_space</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">inversion</span> <span class="id" title="var">NoSpaces</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">intro</span> <span class="id" title="var">Contra</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">a_space</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IHname'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
    Instantiate a username object if it
    passes <span class="inlinecode"><a class="idref" href="Proofchat.theories.Messages.html#validate_username"><span class="id" title="definition">validate_username</span></a></span>, or return
    <span class="inlinecode"><span class="id" title="var">None</span></span>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="new_username" class="idref" href="#new_username"><span class="id" title="definition">new_username</span></a> (<a id="s:8" class="idref" href="#s:8"><span class="id" title="binder">s</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) : <a class="idref" href="Proofchat.theories.Monads.html#optionE"><span class="id" title="inductive">optionE</span></a> <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Proofchat.theories.Messages.html#validate_username"><span class="id" title="definition">validate_username</span></a> <span class="id" title="var">s</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Proofchat.theories.Messages.html#validate_username_correct"><span class="id" title="lemma">validate_username_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<a class="idref" href="Proofchat.theories.Monads.html#SomeE"><span class="id" title="constructor">SomeE</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Messages.html#Uname"><span class="id" title="projection">Uname</span></a> := <span class="id" title="var">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Messages.html#ValidLength"><span class="id" title="projection">ValidLength</span></a> := <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Messages.html#NoSpaces"><span class="id" title="projection">NoSpaces</span></a> := <span class="id" title="var">H0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="Proofchat.theories.StringTheory.html#no_spaces"><span class="id" title="definition">no_spaces</span></a> <span class="id" title="var">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<a class="idref" href="Proofchat.theories.Monads.html#NoneE"><span class="id" title="constructor">NoneE</span></a> "Username length must be in range [1..32]").<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<a class="idref" href="Proofchat.theories.Monads.html#NoneE"><span class="id" title="constructor">NoneE</span></a> "Username cannot contain spaces").<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
    The message types sent by a client to the server

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="client_message" class="idref" href="#client_message"><span class="id" title="definition, inductive"><span id="client_message_rect" class="id"><span id="client_message_ind" class="id"><span id="client_message_rec" class="id"><span id="client_message_sind" class="id">client_message</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
</div>

<div class="doc">
    Purpose: Register new user "name" with the chat server.

<div class="paragraph"> </div>

    Server Response: <span class="inlinecode"><a class="idref" href="Proofchat.theories.Messages.html#ACK"><span class="id" title="constructor">ACK</span></a></span> with number of users and list
        of users. Send message to all other
        users that "name" has joined chat.

</div>
<div class="code">
| <a id="REG" class="idref" href="#REG"><span class="id" title="constructor">REG</span></a>   (<a id="name:11" class="idref" href="#name:11"><span class="id" title="binder">name</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>)<br/>
</div>

<div class="doc">
    Purpose: Send broadcast "message" to the entire chatroom.

<div class="paragraph"> </div>

    Server Response: Send "message" to all users in
        chatroom except sender. Include
        username of sender.

</div>
<div class="code">
| <a id="MESG" class="idref" href="#MESG"><span class="id" title="constructor">MESG</span></a>  (<a id="message:12" class="idref" href="#message:12"><span class="id" title="binder">message</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>)<br/>
</div>

<div class="doc">
    Purpose: Send private "message" to "user".

<div class="paragraph"> </div>

    Server Response: Send "message" to "user". Include
        username of sender.

</div>
<div class="code">
| <a id="PMSG" class="idref" href="#PMSG"><span class="id" title="constructor">PMSG</span></a>  (<a id="message:13" class="idref" href="#message:13"><span class="id" title="binder">message</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="target:14" class="idref" href="#target:14"><span class="id" title="binder">target</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>)<br/>
</div>

<div class="doc">
    Purpose: Inform that "name" is leaving chat.

<div class="paragraph"> </div>

    Server Response: De-register "name". <span class="inlinecode"><a class="idref" href="Proofchat.theories.Messages.html#ACK"><span class="id" title="constructor">ACK</span></a></span> with
        updated number of users and list of
        remaining users. Send message to
        remaining users that "name" has
        left chat.

</div>
<div class="code">
| <a id="EXIT" class="idref" href="#EXIT"><span class="id" title="constructor">EXIT</span></a>  (<a id="name:15" class="idref" href="#name:15"><span class="id" title="binder">name</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="serialize_string" class="idref" href="#serialize_string"><span class="id" title="definition">serialize_string</span></a> (<a id="s:16" class="idref" href="#s:16"><span class="id" title="binder">s</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.OCamlTypes.html#int63_to_bytes"><span class="id" title="axiom">int63_to_bytes</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#int_len_string"><span class="id" title="definition">int_len_string</span></a> <a class="idref" href="Proofchat.theories.Messages.html#s:16"><span class="id" title="variable">s</span></a>)<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.StringTheory.html#bytes_of_string"><span class="id" title="definition">bytes_of_string</span></a> <a class="idref" href="Proofchat.theories.Messages.html#s:16"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="serialize_username" class="idref" href="#serialize_username"><span class="id" title="definition">serialize_username</span></a> (<a id="u:17" class="idref" href="#u:17"><span class="id" title="binder">u</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>) : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.StringTheory.html#bytes_of_string"><span class="id" title="definition">bytes_of_string</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#pad_string_r"><span class="id" title="definition">pad_string_r</span></a> <a class="idref" href="Proofchat.theories.Messages.html#u:17"><span class="id" title="variable">u</span></a>.(<a class="idref" href="Proofchat.theories.Messages.html#Uname"><span class="id" title="projection">Uname</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x00"><span class="id" title="constructor">x00</span></a> 32).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="serialize_client_message" class="idref" href="#serialize_client_message"><span class="id" title="definition">serialize_client_message</span></a> (<a id="cm:18" class="idref" href="#cm:18"><span class="id" title="binder">cm</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#client_message"><span class="id" title="inductive">client_message</span></a>) : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Proofchat.theories.Messages.html#cm:18"><span class="id" title="variable">cm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#REG"><span class="id" title="constructor">REG</span></a> <span class="id" title="var">name</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x00"><span class="id" title="constructor">x00</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_username"><span class="id" title="definition">serialize_username</span></a> <span class="id" title="var">name</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#MESG"><span class="id" title="constructor">MESG</span></a> <span class="id" title="var">msg</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x01"><span class="id" title="constructor">x01</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_string"><span class="id" title="definition">serialize_string</span></a> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#PMSG"><span class="id" title="constructor">PMSG</span></a> <span class="id" title="var">message</span> <span class="id" title="var">name</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x02"><span class="id" title="constructor">x02</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_username"><span class="id" title="definition">serialize_username</span></a> <span class="id" title="var">name</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_string"><span class="id" title="definition">serialize_string</span></a> <span class="id" title="var">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#EXIT"><span class="id" title="constructor">EXIT</span></a> <span class="id" title="var">name</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x03"><span class="id" title="constructor">x03</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_username"><span class="id" title="definition">serialize_username</span></a> <span class="id" title="var">name</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="deserialize_client_message" class="idref" href="#deserialize_client_message"><span class="id" title="definition">deserialize_client_message</span></a> (<a id="b:20" class="idref" href="#b:20"><span class="id" title="binder">b</span></a> : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a>) : <a class="idref" href="Proofchat.theories.Monads.html#optionE"><span class="id" title="inductive">optionE</span></a> <a class="idref" href="Proofchat.theories.Messages.html#client_message"><span class="id" title="inductive">client_message</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Proofchat.theories.Messages.html#b:20"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x00"><span class="id" title="constructor">x00</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="uname:22" class="idref" href="#uname:22"><span class="id" title="binder">uname</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.Messages.html#new_username"><span class="id" title="definition">new_username</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <span class="id" title="var">t</span>) <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">return</span></a> <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.Messages.html#REG"><span class="id" title="constructor">REG</span></a> <a class="idref" href="Proofchat.theories.Messages.html#uname:22"><span class="id" title="variable">uname</span></a><a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x01"><span class="id" title="constructor">x01</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">return</span></a> <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.Messages.html#MESG"><span class="id" title="constructor">MESG</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <span class="id" title="var">t</span>)<a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x02"><span class="id" title="constructor">x02</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="name_bytes:23" class="idref" href="#name_bytes:23"><span class="id" title="binder">name_bytes</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#first_n"><span class="id" title="definition">first_n</span></a> <span class="id" title="var">t</span> 32 <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="uname:24" class="idref" href="#uname:24"><span class="id" title="binder">uname</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.Messages.html#new_username"><span class="id" title="definition">new_username</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <a class="idref" href="Proofchat.theories.Messages.html#name_bytes:23"><span class="id" title="variable">name_bytes</span></a>) <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="msg_bytes:25" class="idref" href="#msg_bytes:25"><span class="id" title="binder">msg_bytes</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#last_n"><span class="id" title="definition">last_n</span></a> <span class="id" title="var">t</span> (<a class="idref" href="Proofchat.theories.StringTheory.html#int_len_list"><span class="id" title="definition">int_len_list</span></a> <span class="id" title="var">t</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#Sint63NotationsInternalB.::sint63_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 32) <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">return</span></a> <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.Messages.html#PMSG"><span class="id" title="constructor">PMSG</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <a class="idref" href="Proofchat.theories.Messages.html#msg_bytes:25"><span class="id" title="variable">msg_bytes</span></a>) <a class="idref" href="Proofchat.theories.Messages.html#uname:24"><span class="id" title="variable">uname</span></a><a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x03"><span class="id" title="constructor">x03</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="uname:26" class="idref" href="#uname:26"><span class="id" title="binder">uname</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.Messages.html#new_username"><span class="id" title="definition">new_username</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <span class="id" title="var">t</span>) <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">return</span></a> <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.Messages.html#EXIT"><span class="id" title="constructor">EXIT</span></a> <a class="idref" href="Proofchat.theories.Messages.html#uname:26"><span class="id" title="variable">uname</span></a><a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="Proofchat.theories.Monads.html#NoneE"><span class="id" title="constructor">NoneE</span></a> ("Client message code not recognized: " <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <a class="idref" href="Proofchat.theories.Messages.html#b:20"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
    Types of server errors that can be sent to clients

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="error" class="idref" href="#error"><span class="id" title="definition, inductive"><span id="error_rect" class="id"><span id="error_ind" class="id"><span id="error_rec" class="id"><span id="error_sind" class="id">error</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
| <a id="UsernameTaken" class="idref" href="#UsernameTaken"><span class="id" title="constructor">UsernameTaken</span></a><br/>
| <a id="UsernameTooLong" class="idref" href="#UsernameTooLong"><span class="id" title="constructor">UsernameTooLong</span></a><br/>
| <a id="UsernameHasSpaces" class="idref" href="#UsernameHasSpaces"><span class="id" title="constructor">UsernameHasSpaces</span></a><br/>
| <a id="PmsgTargetNotExists" class="idref" href="#PmsgTargetNotExists"><span class="id" title="constructor">PmsgTargetNotExists</span></a><br/>
| <a id="UnknownMessageFormat" class="idref" href="#UnknownMessageFormat"><span class="id" title="constructor">UnknownMessageFormat</span></a><br/>
| <a id="Error" class="idref" href="#Error"><span class="id" title="constructor">Error</span></a>.<br/>

<br/>
</div>

<div class="doc">
    Map errors to OCaml integers

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="int_of_error" class="idref" href="#int_of_error"><span class="id" title="definition">int_of_error</span></a> (<a id="e:29" class="idref" href="#e:29"><span class="id" title="binder">e</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#error"><span class="id" title="inductive">error</span></a>) : <span class="id" title="var">int</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Proofchat.theories.Messages.html#e:29"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#UsernameTaken"><span class="id" title="constructor">UsernameTaken</span></a> ⇒ 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#UsernameTooLong"><span class="id" title="constructor">UsernameTooLong</span></a> ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#UsernameHasSpaces"><span class="id" title="constructor">UsernameHasSpaces</span></a> ⇒ 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#PmsgTargetNotExists"><span class="id" title="constructor">PmsgTargetNotExists</span></a> ⇒ 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#UnknownMessageFormat"><span class="id" title="constructor">UnknownMessageFormat</span></a> ⇒ 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#Error"><span class="id" title="constructor">Error</span></a> ⇒ 5<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
    Map OCaml integers to errors

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="error_of_int" class="idref" href="#error_of_int"><span class="id" title="definition">error_of_int</span></a> (<a id="n:31" class="idref" href="#n:31"><span class="id" title="binder">n</span></a> : <span class="id" title="var">int</span>) : <a class="idref" href="Proofchat.theories.Messages.html#error"><span class="id" title="inductive">error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#to_Z"><span class="id" title="definition">to_Z</span></a> <a class="idref" href="Proofchat.theories.Messages.html#n:31"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 ⇒ <a class="idref" href="Proofchat.theories.Messages.html#UsernameTaken"><span class="id" title="constructor">UsernameTaken</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 1 ⇒ <a class="idref" href="Proofchat.theories.Messages.html#UsernameTooLong"><span class="id" title="constructor">UsernameTooLong</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 2 ⇒ <a class="idref" href="Proofchat.theories.Messages.html#UsernameHasSpaces"><span class="id" title="constructor">UsernameHasSpaces</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 3 ⇒ <a class="idref" href="Proofchat.theories.Messages.html#PmsgTargetNotExists"><span class="id" title="constructor">PmsgTargetNotExists</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 4 ⇒ <a class="idref" href="Proofchat.theories.Messages.html#UnknownMessageFormat"><span class="id" title="constructor">UnknownMessageFormat</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="Proofchat.theories.Messages.html#Error"><span class="id" title="constructor">Error</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
    The message types sent from the server to clients

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="server_message" class="idref" href="#server_message"><span class="id" title="definition, inductive"><span id="server_message_rect" class="id"><span id="server_message_ind" class="id"><span id="server_message_rec" class="id"><span id="server_message_sind" class="id">server_message</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
</div>

<div class="doc">
    Purpose: Confirms successful registration,
        indicates number of users in chat
        (including user who just joined),
        lists all users (including user who
        just joined).
    Client Response: Displays information to user.
        Prompts user for chat messages.

</div>
<div class="code">
| <a id="ACK" class="idref" href="#ACK"><span class="id" title="constructor">ACK</span></a> (<a id="num_users:34" class="idref" href="#num_users:34"><span class="id" title="binder">num_users</span></a> : <span class="id" title="var">int</span>) (<a id="users:35" class="idref" href="#users:35"><span class="id" title="binder">users</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>)<br/>
</div>

<div class="doc">
    Purpose: Chat "message" from "username" to be
        sent to clients. If the message is to
        inform of a user joining or leaving
        chat, "name" is set to “SERVER”.
    Client Response: Displays username of sender and
        message to user.

</div>
<div class="code">
| <a id="MSG" class="idref" href="#MSG"><span class="id" title="constructor">MSG</span></a> (<a id="name:36" class="idref" href="#name:36"><span class="id" title="binder">name</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#username"><span class="id" title="record">username</span></a>) (<a id="message:37" class="idref" href="#message:37"><span class="id" title="binder">message</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>)<br/>
</div>

<div class="doc">
    Purpose: An error has occurred. Error codes:
        0: Username taken
        1: Username too long
        2: Username contains spaces
        3: Unknown user for private
        message
        4: Unknown message format
    Client Response: Handles error appropriately
        depending on errorcode.

</div>
<div class="code">
| <a id="ERR" class="idref" href="#ERR"><span class="id" title="constructor">ERR</span></a> (<a id="err:38" class="idref" href="#err:38"><span class="id" title="binder">err</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#error"><span class="id" title="inductive">error</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="serialize_server_message" class="idref" href="#serialize_server_message"><span class="id" title="definition">serialize_server_message</span></a> (<a id="sm:39" class="idref" href="#sm:39"><span class="id" title="binder">sm</span></a> : <a class="idref" href="Proofchat.theories.Messages.html#server_message"><span class="id" title="inductive">server_message</span></a>) : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Proofchat.theories.Messages.html#sm:39"><span class="id" title="variable">sm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#ACK"><span class="id" title="constructor">ACK</span></a> <span class="id" title="var">num_users</span> <span class="id" title="var">users</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x00"><span class="id" title="constructor">x00</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.OCamlTypes.html#int63_to_bytes"><span class="id" title="axiom">int63_to_bytes</span></a> <span class="id" title="var">num_users</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#concat"><span class="id" title="definition">List.concat</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_username"><span class="id" title="definition">serialize_username</span></a> <span class="id" title="var">users</span>)<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#MSG"><span class="id" title="constructor">MSG</span></a> <span class="id" title="var">name</span> <span class="id" title="var">message</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x01"><span class="id" title="constructor">x01</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_username"><span class="id" title="definition">serialize_username</span></a> <span class="id" title="var">name</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Proofchat.theories.Messages.html#serialize_string"><span class="id" title="definition">serialize_string</span></a> <span class="id" title="var">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Proofchat.theories.Messages.html#ERR"><span class="id" title="constructor">ERR</span></a> <span class="id" title="var">err</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x02"><span class="id" title="constructor">x02</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Proofchat.theories.OCamlTypes.html#int63_to_bytes"><span class="id" title="axiom">int63_to_bytes</span></a> (<a class="idref" href="Proofchat.theories.Messages.html#int_of_error"><span class="id" title="definition">int_of_error</span></a> <span class="id" title="var">err</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="deserialize_server_message" class="idref" href="#deserialize_server_message"><span class="id" title="definition">deserialize_server_message</span></a> (<a id="b:41" class="idref" href="#b:41"><span class="id" title="binder">b</span></a> : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a>) : <a class="idref" href="Proofchat.theories.Monads.html#optionE"><span class="id" title="inductive">optionE</span></a> <a class="idref" href="Proofchat.theories.Messages.html#server_message"><span class="id" title="inductive">server_message</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Proofchat.theories.Messages.html#b:41"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#x00"><span class="id" title="constructor">x00</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="num_users_bytes:43" class="idref" href="#num_users_bytes:43"><span class="id" title="binder">num_users_bytes</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#first_n"><span class="id" title="definition">first_n</span></a> <span class="id" title="var">t</span> 8 <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="users_bytes:44" class="idref" href="#users_bytes:44"><span class="id" title="binder">users_bytes</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#last_n"><span class="id" title="definition">last_n</span></a> <span class="id" title="var">t</span> (<a class="idref" href="Proofchat.theories.StringTheory.html#int_len_list"><span class="id" title="definition">int_len_list</span></a> <span class="id" title="var">t</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#Sint63NotationsInternalB.::sint63_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 8) <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="num_users:45" class="idref" href="#num_users:45"><span class="id" title="binder">num_users</span></a> := <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes_to_int63"><span class="id" title="axiom">bytes_to_int63</span></a> <a class="idref" href="Proofchat.theories.Messages.html#num_users_bytes:43"><span class="id" title="variable">num_users_bytes</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="usernames_bytes:46" class="idref" href="#usernames_bytes:46"><span class="id" title="binder">usernames_bytes</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.StringTheory.html#divide"><span class="id" title="lemma">divide</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Byte.html#byte"><span class="id" title="inductive">byte</span></a> <span class="id" title="var">t</span> 32 <a class="idref" href="Proofchat.theories.Messages.html#num_users:45"><span class="id" title="variable">num_users</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="option_usernames:48" class="idref" href="#option_usernames:48"><span class="id" title="binder">option_usernames</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="b:47" class="idref" href="#b:47"><span class="id" title="binder">b</span></a> ⇒ <a class="idref" href="Proofchat.theories.Messages.html#new_username"><span class="id" title="definition">new_username</span></a> (<a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <a class="idref" href="Proofchat.theories.Messages.html#b:47"><span class="id" title="variable">b</span></a>)) <a class="idref" href="Proofchat.theories.Messages.html#usernames_bytes:46"><span class="id" title="variable">usernames_bytes</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="usernames:49" class="idref" href="#usernames:49"><span class="id" title="binder">usernames</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Proofchat.theories.Monads.html#strip_options"><span class="id" title="definition">strip_options</span></a> <a class="idref" href="Proofchat.theories.Messages.html#option_usernames:48"><span class="id" title="variable">option_usernames</span></a> <a class="idref" href="Proofchat.theories.Monads.html#baae863c34ce3e3e2291505557779782"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">return</span></a> <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.Messages.html#ACK"><span class="id" title="constructor">ACK</span></a> <a class="idref" href="Proofchat.theories.Messages.html#num_users:45"><span class="id" title="variable">num_users</span></a> <a class="idref" href="Proofchat.theories.Messages.html#usernames:49"><span class="id" title="variable">usernames</span></a><a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'return'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="Proofchat.theories.Monads.html#::monad_scope:'fail'_x"><span class="id" title="notation">fail</span></a> "x"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">resend</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="fuel:50" class="idref" href="#fuel:50"><span class="id" title="binder"><span id="fuel:57" class="id"><span id="fuel:62" class="id"><span id="fuel:68" class="id"><span id="fuel:74" class="id"><span id="fuel:79" class="id">fuel</span></span></span></span></span></span></a> : <span class="id" title="var">int</span>) (<a id="n_sent:51" class="idref" href="#n_sent:51"><span class="id" title="binder"><span id="n_sent:58" class="id"><span id="n_sent:63" class="id"><span id="n_sent:69" class="id"><span id="n_sent:75" class="id"><span id="n_sent:80" class="id">n_sent</span></span></span></span></span></span></a> : <span class="id" title="var">int</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="sockfd:52" class="idref" href="#sockfd:52"><span class="id" title="binder"><span id="sockfd:59" class="id"><span id="sockfd:64" class="id"><span id="sockfd:70" class="id"><span id="sockfd:76" class="id"><span id="sockfd:81" class="id">sockfd</span></span></span></span></span></span></a> : <a class="idref" href="Proofchat.theories.Sockets.html#file_descr"><span class="id" title="axiom">file_descr</span></a>) (<a id="message:53" class="idref" href="#message:53"><span class="id" title="binder"><span id="message:60" class="id"><span id="message:65" class="id"><span id="message:71" class="id"><span id="message:77" class="id"><span id="message:82" class="id">message</span></span></span></span></span></span></a> : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="len_msg:54" class="idref" href="#len_msg:54"><span class="id" title="binder"><span id="len_msg:61" class="id"><span id="len_msg:66" class="id"><span id="len_msg:72" class="id"><span id="len_msg:78" class="id"><span id="len_msg:83" class="id">len_msg</span></span></span></span></span></span></a> : <span class="id" title="var">int</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="keyword">measure</span> (<span class="id" title="keyword">fun</span> <a id="x:86" class="idref" href="#x:86"><span class="id" title="binder">x</span></a> ⇒ (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#to_Z"><span class="id" title="definition">to_Z</span></a> <a class="idref" href="Proofchat.theories.Messages.html#x:86"><span class="id" title="variable">x</span></a>))) <span class="id" title="var">fuel</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Proofchat.theories.Monads.html#optionE"><span class="id" title="inductive">optionE</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Proofchat.theories.OCamlTypes.html#sub1_no_underflow"><span class="id" title="definition">sub1_no_underflow</span></a> <a class="idref" href="Proofchat.theories.Messages.html#fuel:50"><span class="id" title="variable">fuel</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#3af0b78a7fcef553558137a00f6c6142"><span class="id" title="notation">let</span></a><a class="idref" href="Proofchat.theories.Monads.html#3af0b78a7fcef553558137a00f6c6142"><span class="id" title="notation">×</span></a> <a class="idref" href="Proofchat.theories.Monads.html#3af0b78a7fcef553558137a00f6c6142"><span class="id" title="notation">_</span></a> <a class="idref" href="Proofchat.theories.Monads.html#3af0b78a7fcef553558137a00f6c6142"><span class="id" title="notation">≤</span></a> <a class="idref" href="Proofchat.theories.OCamlTypes.html#print_endline"><span class="id" title="axiom">print_endline</span></a> ("Sent " <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.OCamlTypes.html#string_of_int"><span class="id" title="axiom">string_of_int</span></a> <a class="idref" href="Proofchat.theories.Messages.html#n_sent:51"><span class="id" title="variable">n_sent</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">++</span></a> " bytes") <a class="idref" href="Proofchat.theories.Monads.html#3af0b78a7fcef553558137a00f6c6142"><span class="id" title="notation">#;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="n_sent':56" class="idref" href="#n_sent':56"><span class="id" title="binder"><span id="n_sent':73" class="id"><span id="n_sent':84" class="id">n_sent'</span></span></span></a> := <a class="idref" href="Proofchat.theories.OCamlTypes.html#send"><span class="id" title="axiom">send</span></a> <a class="idref" href="Proofchat.theories.Messages.html#sockfd:52"><span class="id" title="variable">sockfd</span></a> <a class="idref" href="Proofchat.theories.Messages.html#message:53"><span class="id" title="variable">message</span></a> <a class="idref" href="Proofchat.theories.Messages.html#n_sent:51"><span class="id" title="variable">n_sent</span></a> (<a class="idref" href="Proofchat.theories.Messages.html#len_msg:54"><span class="id" title="variable">len_msg</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#Sint63NotationsInternalB.::sint63_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Proofchat.theories.Messages.html#n_sent:51"><span class="id" title="variable">n_sent</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Proofchat.theories.Messages.html#n_sent:51"><span class="id" title="variable">n_sent</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#0a2e550b384dcb205d616c9db42fe935"><span class="id" title="notation">+</span></a> <a class="idref" href="Proofchat.theories.Messages.html#n_sent':56"><span class="id" title="variable">n_sent'</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#17a948dabbb8c725b8f0a8c90a8c4f10"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Proofchat.theories.Messages.html#len_msg:54"><span class="id" title="variable">len_msg</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Messages.html#resend:55"><span class="id" title="definition">resend</span></a> (<a class="idref" href="Proofchat.theories.Messages.html#fuel:50"><span class="id" title="variable">fuel</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#Sint63NotationsInternalB.::sint63_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) (<a class="idref" href="Proofchat.theories.Messages.html#n_sent:51"><span class="id" title="variable">n_sent</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#0a2e550b384dcb205d616c9db42fe935"><span class="id" title="notation">+</span></a> <a class="idref" href="Proofchat.theories.Messages.html#n_sent':56"><span class="id" title="variable">n_sent'</span></a>) <a class="idref" href="Proofchat.theories.Messages.html#sockfd:52"><span class="id" title="variable">sockfd</span></a> <a class="idref" href="Proofchat.theories.Messages.html#message:53"><span class="id" title="variable">message</span></a> <a class="idref" href="Proofchat.theories.Messages.html#len_msg:54"><span class="id" title="variable">len_msg</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#SomeE"><span class="id" title="constructor">SomeE</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#NoneE"><span class="id" title="constructor">NoneE</span></a> ("Timed out while sending message '" <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">(</span></a><a class="idref" href="Proofchat.theories.StringTheory.html#string_of_bytes"><span class="id" title="definition">string_of_bytes</span></a> <a class="idref" href="Proofchat.theories.Messages.html#message:53"><span class="id" title="variable">message</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Strings.String.html#169ad156fbc6036a53a0338819a2b301"><span class="id" title="notation">++</span></a> "'").<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prove_sub1</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="send_message" class="idref" href="#send_message"><span class="id" title="definition">send_message</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="sockfd:117" class="idref" href="#sockfd:117"><span class="id" title="binder">sockfd</span></a> : <a class="idref" href="Proofchat.theories.Sockets.html#file_descr"><span class="id" title="axiom">file_descr</span></a>) (<a id="message:118" class="idref" href="#message:118"><span class="id" title="binder">message</span></a> : <a class="idref" href="Proofchat.theories.OCamlTypes.html#bytes"><span class="id" title="definition">bytes</span></a>) : <a class="idref" href="Proofchat.theories.Monads.html#optionE"><span class="id" title="inductive">optionE</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="len_msg:119" class="idref" href="#len_msg:119"><span class="id" title="binder">len_msg</span></a> := <a class="idref" href="Proofchat.theories.StringTheory.html#int_len_list"><span class="id" title="definition">int_len_list</span></a> <a class="idref" href="Proofchat.theories.Messages.html#message:118"><span class="id" title="variable">message</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="n_sent:120" class="idref" href="#n_sent:120"><span class="id" title="binder">n_sent</span></a> := <a class="idref" href="Proofchat.theories.OCamlTypes.html#send"><span class="id" title="axiom">send</span></a> <a class="idref" href="Proofchat.theories.Messages.html#sockfd:117"><span class="id" title="variable">sockfd</span></a> <a class="idref" href="Proofchat.theories.Messages.html#message:118"><span class="id" title="variable">message</span></a> 0 <a class="idref" href="Proofchat.theories.Messages.html#len_msg:119"><span class="id" title="variable">len_msg</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Proofchat.theories.Messages.html#n_sent:120"><span class="id" title="variable">n_sent</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Numbers.Cyclic.Int63.Sint63.html#a5702614ed847ad2954e9299f1612b24"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="Proofchat.theories.Messages.html#len_msg:119"><span class="id" title="variable">len_msg</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Messages.html#resend"><span class="id" title="lemma">resend</span></a> 100 <a class="idref" href="Proofchat.theories.Messages.html#n_sent:120"><span class="id" title="variable">n_sent</span></a> <a class="idref" href="Proofchat.theories.Messages.html#sockfd:117"><span class="id" title="variable">sockfd</span></a> <a class="idref" href="Proofchat.theories.Messages.html#message:118"><span class="id" title="variable">message</span></a> <a class="idref" href="Proofchat.theories.Messages.html#len_msg:119"><span class="id" title="variable">len_msg</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Proofchat.theories.Monads.html#SomeE"><span class="id" title="constructor">SomeE</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>